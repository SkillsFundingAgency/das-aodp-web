@if (!ViewContext.ModelState.IsValid)
{
    <div class="govuk-error-summary" data-module="govuk-error-summary">
        <div role="alert">
            <h2 class="govuk-error-summary__title">
                There is a problem
            </h2>
            <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">

                    @foreach (var ms in ViewContext.ModelState)
                    {
                        var error = @ms.Value.Errors.FirstOrDefault();
                        if (error == null) continue;

                        <li>
                            <a href="#@ms.Key">@error.ErrorMessage</a>
                        </li>
                    }

                </ul>
            </div>
        </div>
    </div>
}
<script>
    (function () {
        // Prevent attaching the handler multiple times if the partial is rendered more than once
        if (window.__govukValidationSummaryFileHandlerAttached) {
            return;
        }
        window.__govukValidationSummaryFileHandlerAttached = true;

        // Normalize text for robust comparisons
        function normalizeText(s) {
            return (s || '').replace(/\s+/g, ' ').trim().toLowerCase();
        }

        // Read file error block text (if present)
        function getFileErrorText() {
            var fileError = document.getElementById('File-error');
            return fileError ? normalizeText(fileError.textContent || fileError.innerText) : '';
        }

        // Handle a matched link: only move focus — do NOT call click() so the file dialog is not opened.
        function handleFileLinkFocus(e, target) {
            try { e.preventDefault(); } catch (ex) { /* ignore */ }
            try { e.stopImmediatePropagation(); } catch (ex) { /* ignore */ }
            try { e.stopPropagation(); } catch (ex) { /* ignore */ }
            try { target.setAttribute('tabindex', '0'); } catch (ex) { /* ignore */ }
            try { target.focus(); } catch (ex) { /* ignore */ }
            try { history.replaceState(null, null, '#File'); } catch (ex) { /* ignore */ }
        }

        function onDocClick(e) {
            var el = e.target;
            while (el && el !== document) {
                if (el.tagName && el.tagName.toLowerCase() === 'a' && el.closest && el.closest('.govuk-error-summary')) {
                    var href = el.getAttribute('href') || '';
                    var linkText = normalizeText(el.textContent || el.innerText);
                    var fileErrorText = getFileErrorText();

                    var isExplicitFileLink = (href === '#File');
                    var isHashWithMatchingText = (href === '#' || href === '') && fileErrorText && (
                        fileErrorText.indexOf(linkText) !== -1 ||
                        linkText.indexOf(fileErrorText) !== -1 ||
                        linkText === fileErrorText
                    );

                    if (isExplicitFileLink || isHashWithMatchingText) {
                        // Look up the file input now (it may not have existed when this script ran)
                        var target = document.getElementById('File');
                        if (target) {
                            handleFileLinkFocus(e, target);
                            return;
                        }
                    }
                }
                el = el.parentNode;
            }
        }

        // Attach in capture phase so we can stop propagation and prevent other click handlers
        document.addEventListener('click', onDocClick, { passive: false, capture: true });
    })();
</script>